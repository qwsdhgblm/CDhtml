<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é±¼ç¼¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
            color: #333;
            overflow-x: hidden;
            position: relative;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            text-align: center;
        }
        
        h1 {
            margin-bottom: 20px;
            font-size: 2.5rem;
            color: #2c3e50;
        }
        
        .aquarium-container {
            position: relative;
            width: 100%;
            height: 500px;
            margin: 0 auto 30px;
            perspective: 1000px;
        }
        
        .aquarium {
            position: relative;
            width: 100%;
            height: 100%;
            background: #f0f8ff; /* æµ…è“è‰²èƒŒæ™¯è€Œä¸æ˜¯æ°´ */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 
                inset 0 0 50px rgba(0, 0, 0, 0.3),
                0 20px 50px rgba(0, 0, 0, 0.2);
            border: 15px solid #c8c8c8;
            border-top: 5px solid #e0e0e0;
            border-bottom: 25px solid #a0a0a0;
            transition: all 2s ease;
        }
        
        .water-container {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .water {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to top, rgba(30, 136, 229, 0.7), rgba(33, 150, 243, 0.3));
            transition: height 5s ease;
        }
        
        .sand {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 80px;
            background: linear-gradient(to bottom, #d7ccc8, #bcaaa4);
            border-top: 5px solid #a1887f;
            z-index: 10;
        }
        
        .decoration {
            position: absolute;
            bottom: 80px;
            width: 100%;
            height: 100px;
            z-index: 5;
        }
        
        .rock {
            position: absolute;
            bottom: 0;
            width: 80px;
            height: 60px;
            background: #795548;
            border-radius: 50% 50% 0 0;
        }
        
        .rock1 {
            left: 20%;
        }
        
        .rock2 {
            right: 30%;
            width: 100px;
            height: 70px;
        }
        
        .plant {
            position: absolute;
            bottom: 0;
            width: 20px;
            height: 100px;
            background: linear-gradient(to top, #4caf50, #2e7d32);
            border-radius: 10px 10px 0 0;
        }
        
        .plant1 {
            left: 40%;
            height: 120px;
        }
        
        .plant2 {
            right: 20%;
            height: 80px;
        }
        
        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            animation: bubble-rise linear infinite;
        }
        
        @keyframes bubble-rise {
            0% {
                bottom: 0;
                opacity: 0.7;
            }
            100% {
                bottom: 100%;
                opacity: 0;
            }
        }
        
        .fish {
            position: absolute;
            width: 60px;
            height: 30px;
            transition: transform 0.5s;
            z-index: 10;
        }
        
        .fish-body {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, #ff9800, #ff5722);
            border-radius: 50% 40% 40% 50%;
            box-shadow: inset -5px 0 0 rgba(0, 0, 0, 0.2);
        }
        
        .fish-tail {
            position: absolute;
            left: -15px;
            top: 5px;
            width: 25px;
            height: 25px;
            background: linear-gradient(to right, #ff5722, #ff7043);
            border-radius: 50% 0 0 50%;
            clip-path: polygon(0 0, 100% 25%, 100% 75%, 0 100%);
            transform-origin: right center;
            animation: tail-move 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes tail-move {
            0% {
                transform: rotateY(-10deg);
            }
            100% {
                transform: rotateY(10deg);
            }
        }
        
        .fish-fin {
            position: absolute;
            top: -5px;
            left: 20px;
            width: 10px;
            height: 15px;
            background: #ff9800;
            clip-path: polygon(0 0, 100% 50%, 0 100%);
        }
        
        .fish-eye {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 8px;
            height: 8px;
            background: #000;
            border-radius: 50%;
        }
        
        .dead-fish {
            filter: grayscale(1) brightness(0.7);
            opacity: 0.8;
        }
        
        .dead-fish .fish-tail {
            animation: none;
        }
        
        .food {
            position: absolute;
            width: 8px;
            height: 8px;
            background: #ffeb3b;
            border-radius: 50%;
            z-index: 5;
            box-shadow: 0 0 5px #ff9800;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            z-index: 100;
            position: relative;
        }
        
        button {
            padding: 12px 25px;
            font-size: 1.1rem;
            background: #87CEEB;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        button:hover {
            background: #6CB4EE;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .stats {
            margin-top: 20px;
            font-size: 1.2rem;
            display: flex;
            justify-content: center;
            gap: 30px;
            z-index: 100;
            position: relative;
        }
        
        .fish-count {
            font-weight: bold;
            color: #2c3e50;
        }
        
        .food-count {
            font-weight: bold;
            color: #2c3e50;
        }
        
        /* é”¤å­æŒ‰é’®æ ·å¼ */
        .hammer-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 2rem;
            background: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            cursor: pointer;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .aquarium-container:hover .hammer-btn {
            opacity: 1;
        }
        
        /* ç»ç’ƒç¢ç‰‡æ ·å¼ */
        .glass-shard {
            position: absolute;
            background: rgba(200, 200, 200, 0.8);
            border: 1px solid #aaa;
            z-index: 20;
            transform-origin: center;
        }
        
        /* é¡µé¢åº•éƒ¨æ°´åŸŸæ ·å¼ */
        .floor-water {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 0;
            background: linear-gradient(to top, rgba(106, 183, 255, 0.7), rgba(30, 136, 229, 0.3));
            transition: height 5s ease;
            z-index: 5;
            overflow: hidden;
        }
        
        /* é±¼ç¼¸ç ´è£‚çŠ¶æ€ */
        .aquarium-broken {
            border-color: transparent;
            box-shadow: none;
            transform: scale(0.95);
        }
        
        .aquarium-broken .water {
            height: 0;
        }
        
        /* æƒŠæ…Œçš„é±¼ */
        .panicked-fish {
            animation: panic 0.3s infinite alternate;
        }
        
        @keyframes panic {
            0% {
                transform: translateX(0) rotate(0);
            }
            100% {
                transform: translateX(5px) rotate(5deg);
            }
        }
        
        /* ä½œå¼Šæ¨¡å¼çª—å£ */
        .cheat-modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 2000;
        }
        
        .cheat-modal input {
            padding: 10px;
            margin: 10px 0;
            width: 200px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        
        .obstacle-panel {
            display: none;
            position: fixed;
            top: 100px;
            left: 50px;
            width: 300px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1500;
            cursor: move;
        }
        
        .obstacle-panel-header {
            padding: 10px;
            background: #87CEEB;
            color: white;
            border-radius: 10px 10px 0 0;
            cursor: move;
        }
        
        .obstacle-list {
            padding: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .obstacle-item {
            padding: 8px;
            margin: 5px 0;
            background: #f0f0f0;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
        }
        
        .obstacle-item:hover {
            background: #e0e0e0;
        }
        
        .obstacle-item.selected {
            background: #87CEEB;
            color: white;
        }
        
        .place-obstacle-btn {
            width: 100%;
            padding: 10px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 0;
            cursor: pointer;
        }
        
        .place-obstacle-btn:hover {
            background: #45a049;
        }
        
        /* éšœç¢ç‰©æ ·å¼ */
        .obstacle {
            position: absolute;
            z-index: 30;
        }
        
        .obstacle.circle {
            border-radius: 50%;
            background: rgba(255, 0, 0, 0.3);
            border: 2px solid red;
        }
        
        .obstacle.square {
            background: rgba(0, 0, 255, 0.3);
            border: 2px solid blue;
        }
        
        .obstacle.triangle {
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-bottom: 50px solid rgba(0, 255, 0, 0.3);
            background: transparent;
        }
        
        .obstacle.preview {
            opacity: 0.7;
        }
        
        /* è·Ÿéšé¼ æ ‡çš„é±¼ */
        .fish-following {
            filter: brightness(1.3);
            transition: all 0.5s ease;
        }
        
        /* ä½œå¼Šæ¨¡å¼æ§åˆ¶é¢æ¿ */
        .cheat-controls {
            padding: 10px;
            border-top: 1px solid #eee;
        }
        
        .cheat-control {
            margin: 10px 0;
        }
        
        .cheat-control label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        .cheat-control input {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
        }
        
        .time-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .time-controls button {
            flex: 1;
            padding: 8px;
        }
        
        /* æ—¶é—´æš‚åœçŠ¶æ€ */
        .paused .fish,
        .paused .fish-tail,
        .paused .bubble {
            animation-play-state: paused !important;
        }
        
        .paused-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            z-index: 3000;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>è¿™æ˜¯ä¸€ä¸ªé±¼ç¼¸</h1>
        
        <div class="aquarium-container">
            <div class="aquarium">
                <div class="water-container">
                    <div class="water"></div>
                </div>
                <div class="sand"></div>
                <div class="decoration">
                    <div class="rock rock1"></div>
                    <div class="rock rock2"></div>
                    <div class="plant plant1"></div>
                    <div class="plant plant2"></div>
                </div>
                <!-- é±¼å’Œé¥²æ–™å°†é€šè¿‡JavaScriptåŠ¨æ€æ·»åŠ  -->
            </div>
            <button class="hammer-btn" id="hammerBtn">ğŸ”¨</button>
        </div>
        
        <div class="stats">
            <div>é±¼çš„æ•°é‡: <span id="fishCount" class="fish-count">0</span></div>
            <div>é¥²æ–™æ•°é‡: <span id="foodCount" class="food-count">0</span></div>
        </div>
        
        <div class="controls">
            <button id="addFish">æ·»åŠ ä¸€æ¡é±¼</button>
            <button id="addFood">æ·»åŠ é¥²æ–™</button>
        </div>
    </div>
    
    <div class="floor-water" id="floorWater"></div>
    
    <!-- æ—¶é—´æš‚åœè¦†ç›–å±‚ -->
    <div class="paused-overlay" id="pausedOverlay">æ—¶é—´å·²æš‚åœ</div>
    
    <!-- ä½œå¼Šæ¨¡å¼å¯†ç è¾“å…¥ -->
    <div class="cheat-modal" id="cheatModal">
        <h3>è¾“å…¥ä½œå¼Šå¯†ç </h3>
        <input type="password" id="cheatPassword" placeholder="è¾“å…¥å¯†ç ">
        <button id="submitCheat">ç¡®è®¤</button>
    </div>
    
    <!-- éšœç¢ç‰©é¢æ¿ -->
    <div class="obstacle-panel" id="obstaclePanel">
        <div class="obstacle-panel-header">ä½œå¼Šæ§åˆ¶é¢æ¿</div>
        <div class="obstacle-list">
            <div class="obstacle-item" data-type="circle">åœ†å½¢éšœç¢</div>
            <div class="obstacle-item" data-type="square">æ­£æ–¹å½¢éšœç¢</div>
            <div class="obstacle-item" data-type="triangle">ä¸‰è§’å½¢éšœç¢</div>
        </div>
        <button class="place-obstacle-btn" id="placeObstacleBtn">æ”¾ç½®éšœç¢</button>
        
        <div class="cheat-controls">
            <div class="cheat-control">
                <label for="fishLifespan">é±¼ç”Ÿå­˜æ—¶é—´(åˆ†é’Ÿ):</label>
                <input type="number" id="fishLifespan" min="1" max="60" value="10">
                <button id="applyLifespan">åº”ç”¨</button>
            </div>
            
            <div class="time-controls">
                <button id="pauseTime">æš‚åœæ—¶é—´</button>
                <button id="resumeTime">æ¢å¤æ—¶é—´</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const aquarium = document.querySelector('.aquarium');
            const addFishBtn = document.getElementById('addFish');
            const addFoodBtn = document.getElementById('addFood');
            const fishCountElem = document.getElementById('fishCount');
            const foodCountElem = document.getElementById('foodCount');
            const hammerBtn = document.getElementById('hammerBtn');
            const floorWater = document.getElementById('floorWater');
            const water = document.querySelector('.water');
            const cheatModal = document.getElementById('cheatModal');
            const cheatPassword = document.getElementById('cheatPassword');
            const submitCheat = document.getElementById('submitCheat');
            const obstaclePanel = document.getElementById('obstaclePanel');
            const obstacleItems = document.querySelectorAll('.obstacle-item');
            const placeObstacleBtn = document.getElementById('placeObstacleBtn');
            const fishLifespanInput = document.getElementById('fishLifespan');
            const applyLifespanBtn = document.getElementById('applyLifespan');
            const pauseTimeBtn = document.getElementById('pauseTime');
            const resumeTimeBtn = document.getElementById('resumeTime');
            const pausedOverlay = document.getElementById('pausedOverlay');
            
            let fishCount = 0;
            let foodCount = 0;
            let allFish = [];
            let allFood = [];
            let deadFishCount = 0;
            let isBroken = false;
            let floorWaterHeight = 0;
            let cheatMode = false;
            let placingObstacle = false;
            let currentObstacleType = null;
            let obstaclePreview = null;
            let obstacles = [];
            let followingFish = null;
            let mouseX = 0;
            let mouseY = 0;
            let timePaused = false;
            let globalLifespan = 300000; // 10åˆ†é’Ÿï¼Œé»˜è®¤å€¼
            
            // è·Ÿè¸ªé¼ æ ‡ä½ç½®
            document.addEventListener('mousemove', function(e) {
                if (timePaused) return;
                
                mouseX = e.clientX;
                mouseY = e.clientY;
                
                // æ›´æ–°éšœç¢ç‰©é¢„è§ˆä½ç½®
                if (placingObstacle && obstaclePreview) {
                    const containerRect = isBroken ? floorWater.getBoundingClientRect() : aquarium.getBoundingClientRect();
                    const xPercent = ((mouseX - containerRect.left) / containerRect.width) * 100;
                    const yPercent = ((mouseY - containerRect.top) / containerRect.height) * 100;
                    
                    obstaclePreview.style.left = `${xPercent}%`;
                    obstaclePreview.style.top = `${yPercent}%`;
                }
                
                // éšæœºé€‰æ‹©ä¸€æ¡é±¼è·Ÿéšé¼ æ ‡
                if (allFish.length > 0 && Math.random() < 0.005 && !followingFish) {
                    const randomFishIndex = Math.floor(Math.random() * allFish.length);
                    const fish = allFish[randomFishIndex];
                    if (fish.isAlive && !fish.isFollowing) {
                        fish.isFollowing = true;
                        followingFish = fish;
                        fish.element.classList.add('fish-following');
                        
                        // 5ç§’ååœæ­¢è·Ÿéš
                        setTimeout(() => {
                            if (followingFish) {
                                followingFish.isFollowing = false;
                                followingFish.element.classList.remove('fish-following');
                                followingFish = null;
                            }
                        }, 5000);
                    }
                }
                
                // æ›´æ–°è·Ÿéšé¼ æ ‡çš„é±¼çš„ä½ç½®
                if (followingFish && followingFish.isAlive) {
                    const containerRect = followingFish.container.getBoundingClientRect();
                    const xPercent = ((mouseX - containerRect.left) / containerRect.width) * 100;
                    const yPercent = ((mouseY - containerRect.top) / containerRect.height) * 100;
                    
                    // ç¼“æ…¢ç§»åŠ¨åˆ°é¼ æ ‡ä½ç½®
                    const dx = xPercent - followingFish.x;
                    const dy = yPercent - followingFish.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance > 2) {
                        followingFish.xSpeed = dx * 0.05;
                        followingFish.ySpeed = dy * 0.05;
                        
                        // ç¡®ä¿é±¼çš„æ–¹å‘ä¸ç§»åŠ¨æ–¹å‘ä¸€è‡´
                        if (followingFish.xSpeed > 0 && followingFish.direction < 0) {
                            followingFish.direction = 1;
                            followingFish.element.style.transform = `scaleX(1)`;
                        } else if (followingFish.xSpeed < 0 && followingFish.direction > 0) {
                            followingFish.direction = -1;
                            followingFish.element.style.transform = `scaleX(-1)`;
                        }
                    }
                }
            });
            
            // åˆ›å»ºæ°”æ³¡æ•ˆæœ
            function createBubbles() {
                setInterval(() => {
                    if (isBroken || timePaused) return;
                    
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    
                    // éšæœºå¤§å°å’Œä½ç½®
                    const size = Math.random() * 15 + 5;
                    const left = Math.random() * 100;
                    const duration = Math.random() * 10 + 10;
                    
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${left}%`;
                    bubble.style.animationDuration = `${duration}s`;
                    
                    // å°†æ°”æ³¡æ·»åŠ åˆ°æ°´å®¹å™¨ä¸­
                    document.querySelector('.water-container').appendChild(bubble);
                    
                    // æ°”æ³¡ä¸Šå‡åç§»é™¤
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, duration * 1000);
                }, 500);
            }
            
            // æ·»åŠ é±¼
            function addFish() {
                const fish = document.createElement('div');
                fish.className = 'fish';
                
                // æ ¹æ®æ˜¯å¦ç ´è£‚å†³å®šé±¼çš„åˆå§‹ä½ç½®
                let left, top;
                if (isBroken) {
                    // åœ¨åº•éƒ¨æ°´åŸŸéšæœºä½ç½®
                    left = Math.random() * 100;
                    top = 100 - (Math.random() * floorWaterHeight * 0.8);
                } else {
                    // åœ¨é±¼ç¼¸ä¸­éšæœºä½ç½®
                    left = Math.random() * 80 + 10;
                    top = Math.random() * 60 + 20;
                }
                
                fish.style.left = `${left}%`;
                fish.style.top = `${top}%`;
                
                // éšæœºé¢œè‰²
                const hue = Math.random() * 60 + 10; // æ©™è‰²åˆ°çº¢è‰²èŒƒå›´
                
                // åˆ›å»ºé±¼çš„èº«ä½“éƒ¨ä»¶
                const fishBody = document.createElement('div');
                fishBody.className = 'fish-body';
                fishBody.style.background = `linear-gradient(45deg, hsl(${hue}, 100%, 50%), hsl(${hue + 20}, 100%, 45%))`;
                
                const fishTail = document.createElement('div');
                fishTail.className = 'fish-tail';
                fishTail.style.background = `linear-gradient(to right, hsl(${hue + 20}, 100%, 45%), hsl(${hue + 10}, 100%, 50%))`;
                
                const fishFin = document.createElement('div');
                fishFin.className = 'fish-fin';
                fishFin.style.background = `hsl(${hue}, 100%, 50%)`;
                
                const fishEye = document.createElement('div');
                fishEye.className = 'fish-eye';
                
                fish.appendChild(fishBody);
                fish.appendChild(fishTail);
                fish.appendChild(fishFin);
                fish.appendChild(fishEye);
                
                // æ ¹æ®æ˜¯å¦ç ´è£‚å†³å®šé±¼çš„å®¹å™¨
                if (isBroken) {
                    floorWater.appendChild(fish);
                } else {
                    aquarium.appendChild(fish);
                }
                
                // è®¾ç½®é±¼çš„åˆå§‹æ–¹å‘
                const direction = Math.random() > 0.5 ? 1 : -1;
                fish.style.transform = `scaleX(${direction})`;
                
                // é±¼çš„ç§»åŠ¨
                let x = left;
                let y = top;
                let xSpeed = (Math.random() * 0.3 + 0.1) * direction;
                let ySpeed = (Math.random() * 0.2 - 0.1);
                
                // é±¼çš„å±æ€§
                const fishObj = {
                    element: fish,
                    x: x,
                    y: y,
                    xSpeed: xSpeed,
                    ySpeed: ySpeed,
                    direction: direction,
                    isAlive: true,
                    birthTime: Date.now(),
                    lifeSpan: globalLifespan,
                    hunger: 0,
                    isEating: false,
                    isAgitated: false,
                    isFollowing: false,
                    originalSpeed: { x: xSpeed, y: ySpeed },
                    container: isBroken ? floorWater : aquarium,
                    animationId: null
                };
                
                allFish.push(fishObj);
                fishCount++;
                updateCounts();
                
                // é±¼çš„ç§»åŠ¨åŠ¨ç”»
                function moveFish() {
                    if (timePaused) {
                        fishObj.animationId = requestAnimationFrame(moveFish);
                        return;
                    }
                    
                    if (!fishObj.isAlive) {
                        // é±¼æ­»äº¡åæ²‰åº•
                        if (y < (isBroken ? 100 - floorWaterHeight + 10 : 85)) {
                            y += 0.05;
                            fish.style.top = `${y}%`;
                            fishObj.animationId = requestAnimationFrame(moveFish);
                        } else {
                            // æ²‰åº•åæ ‡è®°ä¸ºå¯æ¸…ç†
                            fish.classList.add('dead-fish');
                            fish.style.cursor = 'pointer';
                            fish.addEventListener('click', removeDeadFish);
                            
                            // æ›´æ–°æ­»é±¼æ•°é‡
                            deadFishCount++;
                            updateFishAgitation();
                            
                            // å¦‚æœä¸æ¸…ç†ï¼Œé±¼ä¼šè…çƒ‚
                            setTimeout(() => {
                                if (fish.parentNode && fishObj.isAlive === false) {
                                    fish.style.opacity = '0.5';
                                    fish.style.filter = 'grayscale(1) brightness(0.5)';
                                }
                            }, 5000); // 30ç§’åå¼€å§‹è…çƒ‚
                        }
                        return;
                    }
                    
                    // å¦‚æœé±¼æ­£åœ¨è·Ÿéšé¼ æ ‡ï¼Œè·³è¿‡å¸¸è§„ç§»åŠ¨é€»è¾‘
                    if (fishObj.isFollowing && fishObj === followingFish) {
                        fishObj.animationId = requestAnimationFrame(moveFish);
                        return;
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦æœ‰æ­»é±¼ï¼Œå¦‚æœæœ‰ï¼Œæ´»é±¼ä¼šæ˜¾å¾—ä¸å®‰
                    if (deadFishCount > 0 && !fishObj.isAgitated) {
                        fishObj.isAgitated = true;
                        fishObj.xSpeed = fishObj.originalSpeed.x * 1.5;
                        fishObj.ySpeed = fishObj.originalSpeed.y * 1.5;
                        fish.style.filter = 'brightness(1.2)';
                    } else if (deadFishCount === 0 && fishObj.isAgitated) {
                        fishObj.isAgitated = false;
                        fishObj.xSpeed = fishObj.originalSpeed.x;
                        fishObj.ySpeed = fishObj.originalSpeed.y;
                        fish.style.filter = 'brightness(1)';
                    }
                    
                    // æ£€æŸ¥æ˜¯å¦åˆ°è¾¾è¾¹ç•Œ
                    const boundaryLeft = 5;
                    const boundaryRight = 95;
                    const boundaryTop = isBroken ? 100 - floorWaterHeight + 5 : 10;
                    const boundaryBottom = isBroken ? 95 : 80;
                    
                    if (x <= boundaryLeft || x >= boundaryRight) {
                        xSpeed = -xSpeed;
                        fishObj.direction = -fishObj.direction;
                        fish.style.transform = `scaleX(${fishObj.direction})`;
                    }
                    
                    if (y <= boundaryTop || y >= boundaryBottom) {
                        ySpeed = -ySpeed;
                    }
                    
                    // é¿å¼€æ­»é±¼
                    if (deadFishCount > 0) {
                        for (const otherFish of allFish) {
                            if (!otherFish.isAlive) {
                                const dx = otherFish.x - x;
                                const dy = otherFish.y - y;
                                const distance = Math.sqrt(dx * dx + dy * dy);
                                
                                if (distance < 20) {
                                    // å¤ªé è¿‘æ­»é±¼ï¼Œè¿œç¦»å®ƒ
                                    xSpeed = (dx < 0 ? 0.2 : -0.2) * (fishObj.isAgitated ? 1.5 : 1);
                                    ySpeed = (dy < 0 ? 0.15 : -0.15) * (fishObj.isAgitated ? 1.5 : 1);
                                    break;
                                }
                            }
                        }
                    }
                    
                    // é¿å¼€éšœç¢ç‰©
                    if (cheatMode && obstacles.length > 0) {
                        for (const obstacle of obstacles) {
                            const dx = obstacle.x - x;
                            const dy = obstacle.y - y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            // ç®€å•çš„éšœç¢ç‰©å›é¿é€»è¾‘
                            if (distance < 15) {
                                xSpeed = (dx < 0 ? 0.2 : -0.2);
                                ySpeed = (dy < 0 ? 0.15 : -0.15);
                                break;
                            }
                        }
                    }
                    
                    // å¯»æ‰¾é£Ÿç‰©
                    if (!fishObj.isEating && allFood.length > 0) {
                        const nearestFood = findNearestFood(x, y);
                        if (nearestFood) {
                            const dx = nearestFood.x - x;
                            const dy = nearestFood.y - y;
                            const distance = Math.sqrt(dx * dx + dy * dy);
                            
                            if (distance < 15) {
                                // æ¥è¿‘é£Ÿç‰©ï¼Œå»åƒ
                                xSpeed = dx * 0.015;
                                ySpeed = dy * 0.015;
                                
                                // ç¡®ä¿é±¼çš„æ–¹å‘ä¸ç§»åŠ¨æ–¹å‘ä¸€è‡´
                                if (xSpeed > 0 && fishObj.direction < 0) {
                                    fishObj.direction = 1;
                                    fish.style.transform = `scaleX(1)`;
                                } else if (xSpeed < 0 && fishObj.direction > 0) {
                                    fishObj.direction = -1;
                                    fish.style.transform = `scaleX(-1)`;
                                }
                                
                                if (distance < 5) {
                                    // åƒåˆ°é£Ÿç‰©
                                    fishObj.isEating = true;
                                    eatFood(fishObj, nearestFood);
                                }
                            }
                        }
                    }
                    
                    // æ›´æ–°ä½ç½®
                    x += xSpeed;
                    y += ySpeed;
                    
                    fish.style.left = `${x}%`;
                    fish.style.top = `${y}%`;
                    
                    // éšæœºæ”¹å˜æ–¹å‘
                    if (Math.random() < 0.01) {
                        xSpeed = (Math.random() * 0.3 + 0.1) * fishObj.direction;
                        fishObj.originalSpeed.x = xSpeed;
                    }
                    if (Math.random() < 0.02) {
                        ySpeed = (Math.random() * 0.2 - 0.1);
                        fishObj.originalSpeed.y = ySpeed;
                    }
                    
                    // ç¡®ä¿é±¼çš„æ–¹å‘ä¸ç§»åŠ¨æ–¹å‘ä¸€è‡´
                    if (xSpeed > 0 && fishObj.direction < 0) {
                        fishObj.direction = 1;
                        fish.style.transform = `scaleX(1)`;
                    } else if (xSpeed < 0 && fishObj.direction > 0) {
                        fishObj.direction = -1;
                        fish.style.transform = `scaleX(-1)`;
                    }
                    
                    // æ£€æŸ¥ç”Ÿå‘½å‘¨æœŸ
                    if (Date.now() - fishObj.birthTime > fishObj.lifeSpan) {
                        fishObj.isAlive = false;
                        fish.style.transition = 'all 2s';
                    }
                    
                    fishObj.animationId = requestAnimationFrame(moveFish);
                }
                
                fishObj.animationId = requestAnimationFrame(moveFish);
            }
            
            // æ›´æ–°é±¼çš„ç„¦è™‘çŠ¶æ€
            function updateFishAgitation() {
                for (const fish of allFish) {
                    if (fish.isAlive) {
                        if (deadFishCount > 0 && !fish.isAgitated) {
                            fish.isAgitated = true;
                            fish.xSpeed = fish.originalSpeed.x * 1.5;
                            fish.ySpeed = fish.originalSpeed.y * 1.5;
                            fish.element.style.filter = 'brightness(1.2)';
                        } else if (deadFishCount === 0 && fish.isAgitated) {
                            fish.isAgitated = false;
                            fish.xSpeed = fish.originalSpeed.x;
                            fish.ySpeed = fish.originalSpeed.y;
                            fish.element.style.filter = 'brightness(1)';
                        }
                    }
                }
            }
            
            // å¯»æ‰¾æœ€è¿‘çš„é£Ÿç‰© - ä¿®å¤å¯¹åº•éƒ¨é¥²æ–™çš„å…´è¶£é—®é¢˜
            function findNearestFood(fishX, fishY) {
                let nearestFood = null;
                let minDistance = Infinity;
                
                for (const food of allFood) {
                    if (food.isEaten) continue;
                    
                    const dx = food.x - fishX;
                    const dy = food.y - fishY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestFood = food;
                    }
                }
                
                return nearestFood;
            }
            
            // åƒé£Ÿç‰©
            function eatFood(fish, food) {
                food.isEaten = true;
                
                // ç§»é™¤é£Ÿç‰©å…ƒç´ 
                if (food.element.parentNode) {
                    food.element.parentNode.removeChild(food.element);
                }
                
                // ä»æ•°ç»„ä¸­ç§»é™¤
                const index = allFood.indexOf(food);
                if (index > -1) {
                    allFood.splice(index, 1);
                    foodCount--;
                    updateCounts();
                }
                
                // åƒå®Œåæ¢å¤æ¸¸åŠ¨
                setTimeout(() => {
                    fish.isEating = false;
                    fish.xSpeed = (Math.random() * 0.3 + 0.1) * fish.direction;
                    fish.ySpeed = (Math.random() * 0.2 - 0.1);
                    fish.originalSpeed.x = fish.xSpeed;
                    fish.originalSpeed.y = fish.ySpeed;
                }, 1000);
            }
            
            // æ·»åŠ é¥²æ–™
            function addFood() {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        const food = document.createElement('div');
                        food.className = 'food';
                        
                        // æ ¹æ®æ˜¯å¦ç ´è£‚å†³å®šé¥²æ–™çš„åˆå§‹ä½ç½®
                        let left, top;
                        if (isBroken) {
                            // åœ¨åº•éƒ¨æ°´åŸŸéšæœºä½ç½®
                            left = Math.random() * 100;
                            top = 100 - (Math.random() * floorWaterHeight * 0.8);
                        } else {
                            // åœ¨é±¼ç¼¸é¡¶éƒ¨éšæœºä½ç½®
                            left = Math.random() * 80 + 10;
                            top = 0;
                        }
                        
                        food.style.left = `${left}%`;
                        food.style.top = `${top}%`;
                        
                        // æ ¹æ®æ˜¯å¦ç ´è£‚å†³å®šé¥²æ–™çš„å®¹å™¨
                        if (isBroken) {
                            floorWater.appendChild(food);
                        } else {
                            aquarium.appendChild(food);
                        }
                        
                        // é¥²æ–™ä¸‹è½
                        let topPos = top;
                        const fallSpeed = Math.random() * 0.5 + 0.3;
                        
                        const foodObj = {
                            element: food,
                            x: left,
                            y: topPos,
                            isEaten: false,
                            container: isBroken ? floorWater : aquarium
                        };
                        
                        allFood.push(foodObj);
                        foodCount++;
                        updateCounts();
                        
                        function fall() {
                            if (foodObj.isEaten || timePaused) return;
                            
                            // æ ¹æ®æ˜¯å¦ç ´è£‚å†³å®šä¸‹è½ç»ˆç‚¹
                            const bottomLimit = isBroken ? 100 - floorWaterHeight + 5 : 85;
                            
                            if (topPos < bottomLimit) {
                                topPos += fallSpeed;
                                food.style.top = `${topPos}%`;
                                foodObj.y = topPos;
                                requestAnimationFrame(fall);
                            } else {
                                // é¥²æ–™å †ç§¯åœ¨åº•éƒ¨
                                food.style.boxShadow = '0 0 3px #ff9800';
                            }
                        }
                        
                        fall();
                    }, i * 200);
                }
            }
            
            // ç§»é™¤æ­»é±¼
            function removeDeadFish(event) {
                const deadFish = event.target.closest('.fish');
                if (deadFish && deadFish.parentNode) {
                    deadFish.parentNode.removeChild(deadFish);
                    
                    // ä»æ•°ç»„ä¸­ç§»é™¤
                    const index = allFish.findIndex(fish => fish.element === deadFish);
                    if (index > -1) {
                        allFish.splice(index, 1);
                        fishCount--;
                        deadFishCount--;
                        updateCounts();
                        updateFishAgitation();
                    }
                }
            }
            
            // æ›´æ–°è®¡æ•°æ˜¾ç¤º
            function updateCounts() {
                fishCountElem.textContent = fishCount;
                foodCountElem.textContent = foodCount;
            }
            
            // åˆ›å»ºç»ç’ƒç¢ç‰‡
            function createGlassShards() {
                const shardCount = 20;
                const aquariumRect = aquarium.getBoundingClientRect();
                
                for (let i = 0; i < shardCount; i++) {
                    const shard = document.createElement('div');
                    shard.className = 'glass-shard';
                    
                    // éšæœºå¤§å°å’Œä½ç½®
                    const size = Math.random() * 30 + 10;
                    const left = Math.random() * aquariumRect.width;
                    const top = Math.random() * aquariumRect.height;
                    
                    shard.style.width = `${size}px`;
                    shard.style.height = `${size}px`;
                    shard.style.left = `${left}px`;
                    shard.style.top = `${top}px`;
                    
                    // éšæœºå½¢çŠ¶
                    shard.style.clipPath = `polygon(${Math.random()*100}% ${Math.random()*100}%, ${Math.random()*100}% ${Math.random()*100}%, ${Math.random()*100}% ${Math.random()*100}%)`;
                    
                    document.body.appendChild(shard);
                    
                    // ç¢ç‰‡æ‰è½åŠ¨ç”»
                    const fallDistance = Math.random() * 300 + 200;
                    const fallDuration = Math.random() * 2 + 1;
                    const rotateAmount = Math.random() * 720 - 360;
                    
                    shard.style.transition = `all ${fallDuration}s ease`;
                    setTimeout(() => {
                        shard.style.transform = `translateY(${fallDistance}px) rotate(${rotateAmount}deg)`;
                        shard.style.opacity = '0';
                    }, 100);
                    
                    // ç§»é™¤ç¢ç‰‡
                    setTimeout(() => {
                        if (shard.parentNode) {
                            shard.parentNode.removeChild(shard);
                        }
                    }, fallDuration * 1000 + 1000);
                }
            }
            
            // é±¼ç¼¸ç ´è£‚æ•ˆæœ
            function breakAquarium() {
                if (isBroken) return;
                
                isBroken = true;
                
                // éšè—é”¤å­æŒ‰é’®
                hammerBtn.style.display = 'none';
                
                // åˆ›å»ºç»ç’ƒç¢ç‰‡
                createGlassShards();
                
                // æ ‡è®°é±¼ç¼¸ä¸ºç ´è£‚çŠ¶æ€
                aquarium.classList.add('aquarium-broken');
                
                // é±¼æƒŠæ…Œæ•ˆæœ
                allFish.forEach(fish => {
                    if (fish.isAlive) {
                        fish.element.classList.add('panicked-fish');
                        // å¢åŠ é±¼çš„ç§»åŠ¨é€Ÿåº¦
                        fish.xSpeed *= 2;
                        fish.ySpeed *= 2;
                    }
                });
                
                // æ°´ä½ä¸‹é™åŠ¨ç”» - ä¿®å¤æ°´å¾€ä¸Šçš„é—®é¢˜
                setTimeout(() => {
                    water.style.height = '0';
                }, 1000);
                
                // åº•éƒ¨æ°´ä½ä¸Šå‡åŠ¨ç”»
                setTimeout(() => {
                    floorWaterHeight = 45; // é¡µé¢é«˜åº¦çš„25%
                    floorWater.style.height = `${floorWaterHeight}%`;
                    
                    // å°†é±¼å’Œé¥²æ–™ç§»åŠ¨åˆ°åº•éƒ¨æ°´åŸŸ
                    allFish.forEach(fish => {
                        if (fish.container === aquarium) {
                            aquarium.removeChild(fish.element);
                            floorWater.appendChild(fish.element);
                            fish.container = floorWater;
                        }
                    });
                    
                    allFood.forEach(food => {
                        if (food.container === aquarium) {
                            aquarium.removeChild(food.element);
                            floorWater.appendChild(food.element);
                            food.container = floorWater;
                        }
                    });
                }, 2000);
                
                // ç§»é™¤æƒŠæ…Œæ•ˆæœ
                setTimeout(() => {
                    allFish.forEach(fish => {
                        fish.element.classList.remove('panicked-fish');
                        // æ¢å¤é±¼çš„æ­£å¸¸é€Ÿåº¦
                        fish.xSpeed /= 2;
                        fish.ySpeed /= 2;
                    });
                }, 3000);
            }
            
            // ä½œå¼Šæ¨¡å¼åŠŸèƒ½
            function activateCheatMode() {
                cheatMode = true;
                cheatModal.style.display = 'none';
                obstaclePanel.style.display = 'block';
                
                // ä½¿éšœç¢ç‰©é¢æ¿å¯æ‹–åŠ¨
                makeDraggable(obstaclePanel);
            }
            
            // ä½¿å…ƒç´ å¯æ‹–åŠ¨
            function makeDraggable(element) {
                let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
                const header = element.querySelector('.obstacle-panel-header');
                
                header.onmousedown = dragMouseDown;
                
                function dragMouseDown(e) {
                    e.preventDefault();
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    document.onmouseup = closeDragElement;
                    document.onmousemove = elementDrag;
                }
                
                function elementDrag(e) {
                    e.preventDefault();
                    pos1 = pos3 - e.clientX;
                    pos2 = pos4 - e.clientY;
                    pos3 = e.clientX;
                    pos4 = e.clientY;
                    element.style.top = (element.offsetTop - pos2) + "px";
                    element.style.left = (element.offsetLeft - pos1) + "px";
                }
                
                function closeDragElement() {
                    document.onmouseup = null;
                    document.onmousemove = null;
                }
            }
            
            // é€‰æ‹©éšœç¢ç‰©ç±»å‹
            obstacleItems.forEach(item => {
                item.addEventListener('click', function() {
                    obstacleItems.forEach(i => i.classList.remove('selected'));
                    this.classList.add('selected');
                    currentObstacleType = this.getAttribute('data-type');
                });
            });
            
            // å¼€å§‹æ”¾ç½®éšœç¢ç‰©
            placeObstacleBtn.addEventListener('click', function() {
                if (!currentObstacleType) return;
                
                placingObstacle = true;
                
                // åˆ›å»ºéšœç¢ç‰©é¢„è§ˆ
                obstaclePreview = document.createElement('div');
                obstaclePreview.className = `obstacle ${currentObstacleType} preview`;
                
                // è®¾ç½®éšœç¢ç‰©å¤§å°
                if (currentObstacleType === 'circle' || currentObstacleType === 'square') {
                    obstaclePreview.style.width = '50px';
                    obstaclePreview.style.height = '50px';
                } else if (currentObstacleType === 'triangle') {
                    obstaclePreview.style.width = '50px';
                    obstaclePreview.style.height = '50px';
                }
                
                // å°†é¢„è§ˆæ·»åŠ åˆ°å½“å‰å®¹å™¨
                if (isBroken) {
                    floorWater.appendChild(obstaclePreview);
                } else {
                    aquarium.appendChild(obstaclePreview);
                }
            });
            
            // æ”¾ç½®éšœç¢ç‰©
            document.addEventListener('mousedown', function(e) {
                if (placingObstacle && obstaclePreview && e.button === 0) {
                    // åˆ›å»ºå®é™…éšœç¢ç‰©
                    const obstacle = document.createElement('div');
                    obstacle.className = `obstacle ${currentObstacleType}`;
                    
                    // è®¾ç½®éšœç¢ç‰©å¤§å°å’Œä½ç½®
                    if (currentObstacleType === 'circle' || currentObstacleType === 'square') {
                        obstacle.style.width = '50px';
                        obstacle.style.height = '50px';
                    } else if (currentObstacleType === 'triangle') {
                        obstacle.style.width = '50px';
                        obstacle.style.height = '50px';
                    }
                    
                    obstacle.style.left = obstaclePreview.style.left;
                    obstacle.style.top = obstaclePreview.style.top;
                    
                    // æ·»åŠ åˆ°å½“å‰å®¹å™¨
                    if (isBroken) {
                        floorWater.appendChild(obstacle);
                    } else {
                        aquarium.appendChild(obstacle);
                    }
                    
                    // å­˜å‚¨éšœç¢ç‰©ä¿¡æ¯
                    const containerRect = isBroken ? floorWater.getBoundingClientRect() : aquarium.getBoundingClientRect();
                    const xPercent = parseFloat(obstacle.style.left);
                    const yPercent = parseFloat(obstacle.style.top);
                    
                    obstacles.push({
                        element: obstacle,
                        x: xPercent,
                        y: yPercent,
                        type: currentObstacleType,
                        container: isBroken ? floorWater : aquarium
                    });
                    
                    // ç§»é™¤é¢„è§ˆ
                    obstaclePreview.parentNode.removeChild(obstaclePreview);
                    obstaclePreview = null;
                    placingObstacle = false;
                }
            });
            
            // åº”ç”¨æ–°çš„ç”Ÿå­˜æ—¶é—´
            applyLifespanBtn.addEventListener('click', function() {
                const newLifespan = parseInt(fishLifespanInput.value) * 60000; // è½¬æ¢ä¸ºæ¯«ç§’
                if (isNaN(newLifespan) || newLifespan < 60000) return;
                
                globalLifespan = newLifespan;
                
                // æ›´æ–°æ‰€æœ‰ç°æœ‰é±¼çš„ç”Ÿå­˜æ—¶é—´
                allFish.forEach(fish => {
                    if (fish.isAlive) {
                        fish.lifeSpan = globalLifespan;
                    }
                });
                
                alert(`é±¼çš„ç”Ÿå­˜æ—¶é—´å·²è®¾ç½®ä¸º ${fishLifespanInput.value} åˆ†é’Ÿ`);
            });
            
            // æš‚åœæ—¶é—´
            pauseTimeBtn.addEventListener('click', function() {
                timePaused = true;
                document.body.classList.add('paused');
                pausedOverlay.style.display = 'flex';
            });
            
            // æ¢å¤æ—¶é—´
            resumeTimeBtn.addEventListener('click', function() {
                timePaused = false;
                document.body.classList.remove('paused');
                pausedOverlay.style.display = 'none';
                
                // é‡æ–°å¯åŠ¨æ‰€æœ‰é±¼çš„åŠ¨ç”»
                allFish.forEach(fish => {
                    if (fish.isAlive && fish.animationId === null) {
                        fish.animationId = requestAnimationFrame(function move() {
                            // é‡æ–°å®ç°ç§»åŠ¨é€»è¾‘
                            fish.animationId = requestAnimationFrame(move);
                        });
                    }
                });
            });
            
            // äº‹ä»¶ç›‘å¬
            addFishBtn.addEventListener('click', addFish);
            addFoodBtn.addEventListener('click', addFood);
            hammerBtn.addEventListener('click', breakAquarium);
            
            // ä½œå¼Šæ¨¡å¼äº‹ä»¶ç›‘å¬
            document.addEventListener('keydown', function(e) {
                if (e.key === 'm' && !cheatMode) {
                    cheatModal.style.display = 'block';
                }
            });
            
            submitCheat.addEventListener('click', function() {
                const password = cheatPassword.value;
                const correctPassword = (fishCount + foodCount).toString();
                
                if (password === correctPassword) {
                    activateCheatMode();
                } else {
                    alert('å¯†ç é”™è¯¯ï¼');
                    cheatPassword.value = '';
                }
            });
            
            // åˆå§‹åŒ–æ°”æ³¡æ•ˆæœ
            createBubbles();
            
            // åˆå§‹æ·»åŠ å‡ æ¡é±¼
            setTimeout(() => addFish(), 500);
            setTimeout(() => addFish(), 1000);
        });
    </script>
</body>
</html>